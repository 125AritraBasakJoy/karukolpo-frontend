<div class="inventory-container p-4 min-h-screen">
    <div class="header-section mb-5">
        <div class="flex flex-column sm:flex-row sm:align-items-center justify-content-between gap-3">
            <div>
                <h1 class="page-title m-0 mb-1">Inventory Management</h1>
                <p class="text-slate-400 m-0 text-sm">Track stock levels and monitor product performance.</p>
            </div>
            <div class="flex gap-2 flex-shrink-0">
                <app-notification-button></app-notification-button>
                <p-button icon="pi pi-refresh" (onClick)="refreshProducts()" styleClass="premium-btn-primary"
                    pTooltip="Refresh Inventory" tooltipPosition="bottom"></p-button>
            </div>
        </div>
    </div>

    <!-- Sales Summary Cards - 2 columns on mobile, 4 on desktop -->
    <div class="stats-grid mb-5">
        <div class="stat-card glass-card">
            <div class="stats-icon-circle orange">
                <i class="pi pi-box"></i>
            </div>
            <span class="stat-label">Total Products</span>
            <h2 class="stat-value">{{ totalRecords() | number }}</h2>
        </div>

        <div class="stat-card glass-card">
            <div class="stats-icon-circle blue">
                <i class="pi pi-shopping-bag"></i>
            </div>
            <span class="stat-label">Units Sold</span>
            <h2 class="stat-value">{{ totalUnitsSold() | number }}</h2>
        </div>

        <div class="stat-card glass-card">
            <div class="stats-icon-circle green">
                <i class="pi pi-wallet"></i>
            </div>
            <span class="stat-label">Total Revenue</span>
            <h2 class="stat-value revenue">{{ totalRevenue() | currency:'BDT':'symbol-narrow':'1.0-0' }}</h2>
        </div>

        <div class="stat-card glass-card">
            <div class="stats-icon-circle purple">
                <i class="pi pi-check-circle"></i>
            </div>
            <span class="stat-label">Completed Orders</span>
            <h2 class="stat-value">{{ confirmedOrdersCount() | number }}</h2>
        </div>
    </div>

    <div class="grid mb-5">
        <div class="col-12">
            <div class="chart-section-card">
                <div class="chart-header">
                    <div class="chart-icon">
                        <i class="pi pi-chart-bar"></i>
                    </div>
                    <h3>Product Sales Performance</h3>
                </div>
                <div *ngIf="chartData; else loadingChart" class="chart-wrapper">
                    <p-chart type="bar" [data]="chartData" [options]="chartOptions" height="250"></p-chart>
                </div>
                <ng-template #loadingChart>
                    <div class="flex align-items-center justify-content-center" style="height: 200px">
                        <p-progressSpinner styleClass="w-3rem h-3rem"></p-progressSpinner>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>

    <div class="glass-card fadein animation-duration-500">
        <p-table #dt [value]="products()" [rows]="10" [paginator]="true" [globalFilterFields]="['name', 'id', 'code']"
            [rowsPerPageOptions]="[10, 25, 50, 100]" [tableStyle]="{'min-width': '60rem'}" styleClass="premium-table-v2"
            [rowHover]="true" [loading]="loading()" [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of many (Buffered)" [lazy]="true"
            (onLazyLoad)="loadProducts($event)" [totalRecords]="totalRecords()">

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="id" style="width: 120px">ID <p-sortIcon field="id"></p-sortIcon></th>
                    <th>Product Image</th>
                    <th pSortableColumn="name" style="min-width: 15rem">Product Name <p-sortIcon
                            field="name"></p-sortIcon></th>
                    <th pSortableColumn="price">Price <p-sortIcon field="price"></p-sortIcon></th>
                    <th pSortableColumn="stock">Status <p-sortIcon field="stock"></p-sortIcon></th>
                    <th class="text-right">Actions</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-product>
                <tr class="table-row">
                    <td>
                        <code class="id-tag">#{{ product.id }}</code>
                    </td>
                    <td>
                        <div class="product-img-container">
                            <img [src]="product.imageUrl" [alt]="product.name" class="product-img" loading="lazy" />
                        </div>
                    </td>
                    <td>
                        <span class="font-semibold text-white">{{ product.name }}</span>
                    </td>
                    <td>
                        <span class="price-value font-medium">{{ product.price | currency:'BDT':'symbol-narrow'
                            }}</span>
                    </td>
                    <td>
                        <div class="status-badge-container">
                            <p-tag [value]="product.manualStockStatus === 'IN_STOCK' ? 'In Stock (Forced)' : 
                                           (product.manualStockStatus === 'OUT_OF_STOCK' ? 'Out of Stock (Forced)' : 
                                           (product.stock > 0 ? 'In Stock (' + product.stock + ')' : 'Out of Stock'))"
                                [severity]="product.manualStockStatus === 'IN_STOCK' ? 'success' : 
                                               (product.manualStockStatus === 'OUT_OF_STOCK' ? 'danger' : 
                                               (product.stock > 0 ? 'success' : 'danger'))"
                                styleClass="custom-stock-tag"></p-tag>
                        </div>
                    </td>
                    <td class="text-right">
                        <div class="flex justify-content-end gap-2">
                            <button pButton pRipple icon="pi pi-box"
                                class="p-button-rounded p-button-text action-btn info-btn"
                                (click)="manageInventory(product)" pTooltip="Manage Inventory"
                                tooltipPosition="top"></button>
                            <button pButton pRipple icon="pi pi-pencil"
                                class="p-button-rounded p-button-text action-btn success-btn"
                                (click)="editProduct(product)" pTooltip="Edit Product" tooltipPosition="top"></button>
                            <button pButton pRipple icon="pi pi-trash"
                                class="p-button-rounded p-button-text action-btn danger-btn"
                                (click)="deleteProduct(product)" pTooltip="Delete Product" tooltipPosition="top"
                                [disabled]="true"></button>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <!-- Skeleton for loading state -->
        <p-table [value]="[1,2,3,4,5,6]" *ngIf="loading()" styleClass="premium-table-v2">
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 120px">ID</th>
                    <th>Product Image</th>
                    <th style="min-width: 15rem">Product Name</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th class="text-right">Actions</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body">
                <tr>
                    <td><p-skeleton width="60px"></p-skeleton></td>
                    <td><p-skeleton width="50px" height="50px" borderRadius="12px"></p-skeleton></td>
                    <td><p-skeleton width="150px"></p-skeleton></td>
                    <td><p-skeleton width="80px"></p-skeleton></td>
                    <td><p-skeleton width="100px" height="24px" borderRadius="20px"></p-skeleton></td>
                    <td class="text-right"><p-skeleton width="100px" height="32px"></p-skeleton></td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>


<p-confirmDialog [style]=" { width: '450px' } " styleClass="premium-confirm-dialog" appendTo="body"></p-confirmDialog>
<p-toast></p-toast>