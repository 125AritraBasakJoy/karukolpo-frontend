<!-- Theme Toggle Button -->
<app-theme-toggle></app-theme-toggle>

<div class="page-wrapper fadein animation-duration-500">
  <div class="track-order-container">
    <div class="glass-card search-card p-5 mb-6">
      <div class="search-section">
        <h1 class="text-4xl font-bold mb-2 text-white">Track Your Order</h1>
        <p class="text-slate-400 mb-5 text-lg">Enter your order ID or registered phone number</p>

        <div
          class="flex flex-column sm:flex-row align-items-center justify-content-center gap-3 w-full md:w-30rem mx-auto">
          <input type="text" pInputText placeholder="e.g. 017..." [(ngModel)]="orderId" (keyup.enter)="trackOrder()"
            class="w-full premium-input">
          <button type="button" pButton icon="pi pi-search" (click)="trackOrder()"
            class="premium-btn-primary p-button-icon-only w-full sm:w-auto px-5"></button>
        </div>
      </div>
    </div>

    <div class="text-center mb-6">
      <p-button label="Back to Home" icon="pi pi-arrow-left" [text]="true" styleClass="premium-btn-secondary"
        (onClick)="goBack()"></p-button>
    </div>

    <!-- Loading Skeleton -->
    <div *ngIf="loading()" class="order-details mt-5">
      <p-card styleClass="premium-card">
        <div class="grid">
          <div class="col-12 md:col-6">
            <p-skeleton width="10rem" height="1.5rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="8rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="6rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="8rem" styleClass="mb-2"></p-skeleton>
          </div>
          <div class="col-12 md:col-6">
            <p-skeleton width="8rem" height="1.5rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="10rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="12rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="10rem" styleClass="mb-2"></p-skeleton>
          </div>
        </div>
        <div class="mt-4">
          <p-skeleton width="5rem" height="1.5rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton styleClass="mb-2"></p-skeleton>
          <p-skeleton styleClass="mb-2"></p-skeleton>
        </div>
      </p-card>
    </div>

    <!-- Order Details -->
    <div *ngIf="order() && !loading()" class="order-details-container mt-6">
      <p-card styleClass="premium-card">
        <div
          class="card-header flex justify-content-between align-items-center mb-5 pb-3 border-bottom-1 border-white-alpha-10">
          <div>
            <span class="text-slate-400 text-sm block mb-1">Order Status</span>
            <p-tag [value]="order()?.status" [severity]="getSeverity(order()?.status)"
              styleClass="text-sm px-3"></p-tag>
          </div>
          <div class="text-right">
            <span class="text-slate-400 text-sm block mb-1">Order #{{ order()?.id }}</span>
            <span class="font-bold text-xl text-white">{{ order()?.orderDate | date:'medium' }}</span>
          </div>
        </div>

        <div class="grid">
          <!-- Customer Info -->
          <div class="col-12 md:col-6 lg:col-4 mb-4 md:mb-0">
            <div class="info-group">
              <h4 class="text-blue-400 font-semibold mb-3 flex align-items-center gap-2">
                <i class="pi pi-user"></i> Shipping Details
              </h4>
              <div class="info-content border-left-2 border-blue-500 pl-3">
                <p class="font-bold m-0 mb-1 text-white">{{ order()?.fullName }}</p>
                <p class="m-0 text-slate-400">{{ order()?.phoneNumber }}</p>
                <p class="m-0 text-slate-400 mt-2">{{ order()?.fullAddress }}</p>
                <p class="m-0 text-slate-400">{{ order()?.district }} - {{ order()?.postalCode }}</p>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="col-12 md:col-6 lg:col-4 mb-4 md:mb-0">
            <div class="info-group">
              <h4 class="text-blue-400 font-semibold mb-3 flex align-items-center gap-2">
                <i class="pi pi-box"></i> Order Summary
              </h4>
              <div class="info-content border-left-2 border-blue-500 pl-3">
                <div class="flex justify-content-between mb-2">
                  <span class="text-slate-400">Total Items:</span>
                  <span class="font-semibold text-white">{{ order()?.items?.length }}</span>
                </div>
                <div class="flex justify-content-between mb-2">
                  <span class="text-slate-400">Payment:</span>
                  <p-tag [value]="order()?.paymentMethod || 'N/A'" severity="info" styleClass="text-xs"></p-tag>
                </div>
                <div class="flex justify-content-between mb-2">
                  <span class="text-slate-400">Subtotal:</span>
                  <span class="font-semibold text-white">{{ (order()?.subtotal || order()?.totalAmount) |
                    currency:'BDT':'symbol-narrow' }}</span>
                </div>
                @if (order()?.deliveryCharge) {
                <div class="flex justify-content-between mb-2">
                  <span class="text-slate-400">Delivery:</span>
                  <span class="font-semibold text-white">{{ order()?.deliveryCharge |
                    currency:'BDT':'symbol-narrow' }}</span>
                </div>
                }
                <div
                  class="flex justify-content-between align-items-center mt-3 pt-2 border-top-1 border-white-alpha-10">
                  <span class="font-bold text-lg text-white">Total:</span>
                  <span class="font-bold text-2xl text-blue-400">{{ order()?.totalAmount |
                    currency:'BDT':'symbol-narrow' }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Items -->
          <div class="col-12 lg:col-4">
            <div class="info-group">
              <h4 class="text-blue-400 font-semibold mb-3 flex align-items-center gap-2">
                <i class="pi pi-list"></i> Items
              </h4>
              <div class="items-list p-3 border-round-xl overflow-y-auto" style="max-height: 200px;">
                <div *ngFor="let item of order()?.items"
                  class="item-row flex justify-content-between align-items-center py-2 border-bottom-1 border-white-alpha-10 last:border-none">
                  <div class="flex align-items-center gap-3">
                    <div class="item-badge bg-blue-500 text-white text-xs px-2 py-1 border-round">{{ item.quantity }}x
                    </div>
                    <span class="text-sm font-medium text-slate-200">{{ item.product.name }}</span>
                  </div>
                  <span class="text-sm font-semibold text-white">{{ (item.product.price * item.quantity) |
                    currency:'BDT':'symbol-narrow' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div
          class="flex flex-column md:flex-row gap-3 mt-6 pt-4 border-top-1 border-white-alpha-10 justify-content-end">
          <p-button *ngIf="order()?.status === 'Pending'" label="Cancel Order" icon="pi pi-times" severity="danger"
            [outlined]="true" (onClick)="cancelOrder()" styleClass="w-full md:w-auto px-4">
          </p-button>
          <p-button label="Back to Shop" icon="pi pi-shopping-bag" (onClick)="goBack()"
            styleClass="premium-btn-primary w-full md:w-auto">
          </p-button>
        </div>
      </p-card>
    </div>
  </div>
</div>

<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>